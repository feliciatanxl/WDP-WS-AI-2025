<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Produce</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='image/Green Minimalist Leaf Plant Logo.png') }}">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

    <link rel="stylesheet" href="{{ url_for('static', filename='global.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='footer.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='navbar.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='product.css') }}">
</head>

<body>

    <header>
        <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm fixed-top">
            <div class="container">
                <a class="navbar-brand" href="/">
                    <img src="{{ url_for('static', filename='image/Green Minimalist Leaf Plant Logo.png') }}" alt="Logo" height="70">
                </a>

                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item"><a class="nav-link" href="/about">About Us</a></li>
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="/product">
                                Our Produce
                            </a>
                        </li>
                        <li class="nav-item"><a class="nav-link" href="/article">Articles</a></li>
                        <li class="nav-item"><a class="nav-link" href="{{ url_for('contact.contact') }}">Contact Us</a></li>
                        <li class="nav-item"><a class="nav-link" href="/account" id="accountLink">Account</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <main class="container main-content-offset pt-5">
        <div class="row">

           <div class="container-fluid mt-4 px-4">
    <div class="row">
        <div class="col-md-3 px-4"> 
            <h6 class="fw-bold mb-3" style="letter-spacing: 1px;">SEARCH PRODUCTS:</h6>
            <div class="search-box mb-4">
                <input type="text" id="search" class="form-control rounded-pill" placeholder="Search products...">
            </div>

            <h6 class="fw-bold mb-3" style="letter-spacing: 1px;">PRODUCT CATEGORIES</h6>
            <ul class="product-category-list list-unstyled">
                <li class="mb-2"><a href="#" class="text-decoration-none text-dark" data-category="all">All</a></li>
                <li class="mb-2"><a href="#" class="text-decoration-none text-dark" data-category="leafy">Leafy Greens</a></li>
                <li class="mb-2"><a href="#" class="text-decoration-none text-dark" data-category="lettuce">Lettuce</a></li>
                <li class="mb-2"><a href="#" class="text-decoration-none text-dark" data-category="chinese">Chinese Vegetables</a></li>
            </ul>
        </div>

        <div class="col-md-9">
            <div class="row g-4">
                {% for product in products %}
                <div class="col-md-4 produce-item" data-category="{{ product.category|lower }}"> <div class="card h-100 shadow-sm border-0" style="border-radius: 15px;">
                        
                        <div style="height: 200px; display: flex; align-items: center; justify-content: center; padding: 15px;">
                            <img src="{{ url_for('static', filename=product.image_file) }}"
                                 alt="{{ product.name }}"
                                 style="max-width: 100%; max-height: 100%; object-fit: contain;">
                        </div>
                        
                        <div class="card-body text-center pt-0">
                            <h5 class="fw-bold mb-1">{{ product.name }}</h5>
                            <p class="text-success fw-bold mb-3">${{ "%.2f"|format(product.price) }}</p>
                            
                            <button class="view-detail-btn w-100 py-2" data-id="{{ product.id }}" style="border: 1.5px solid #333; background: white; border-radius: 25px; font-weight: 500;">
                                View Details
                            </button>

<p id="stock-val-{{ product.id }}" class="d-none">{{ product.available_qty }}</p>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
            </div>
        </div>
    </main>

    <div id="product-detail" class="detail-container">
        <div class="detail-content">
            <button id="close-detail" class="close-btn">&times;</button>
            <h2 id="detail-name"></h2>
            <p id="detail-price"></p>
            <p id="detail-stock" class="text-muted"></p>
            <ul id="detail-description" class="detail-description"></ul>
            <div class="quantity-wrapper">
                <div class="quantity-selector">
                    <div class="quantity-btn" id="qty-minus">−</div>
                    <span class="quantity-number" id="qty-number">1</span>
                    <div class="quantity-btn" id="qty-plus">+</div>
                </div>
            </div>
            <div class="action-row">
                <button class="add-cart-btn mt-3">Add To Cart</button>
            </div>
        </div>
    </div>
    

    <a class="whatsapp-float-button" href="https://wa.me/6580262125" target="_blank" title="Chat with AI Agent">
        <i class="bi bi-whatsapp"></i>
    </a>

    <button id="scrollTopBtn" title="Go to top">
        <i class="bi bi-arrow-up"></i>
    </button>

    <footer class="custom-footer">
        <div class="footer-top">
            <div class="footer-logo">
                <img src="{{ url_for('static', filename='image/Green Minimalist Leaf Plant Logo_Name.png') }}" alt="Logo">
            </div>
            <div class="footer-info">
                <h5>Address</h5>
                <p>123 Main Street<br>Singapore 123456</p>
            </div>
            <div class="footer-info">
                <h5>Email</h5>
                <p>info@AI.com.sg</p>
            </div>
            <div class="footer-socials">
                <a href="#"><i class="bi bi-facebook"></i></a>
                <a href="#"><i class="bi bi-instagram"></i></a>
            </div>
        </div>
        <hr>
        <p class="footer-copy">&copy; 2025 WEB DEVELOPMENT PROJECT TEAM AI.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- 1. Account Link Logic ---
        function updateAccountLink() {
            const accountLink = document.getElementById("accountLink");
            if (accountLink) {
                const userRole = localStorage.getItem('userRole');
                if (userRole === 'admin') {
                    accountLink.textContent = 'Admin Panel';
                    accountLink.href = '/admin/dashboard';
                } else if (userRole === 'user') {
                    accountLink.textContent = 'User Dashboard';
                    accountLink.href = '/account';
                } else {
                    accountLink.textContent = 'Account';
                    accountLink.href = '/account';
                }
            }
        }
        updateAccountLink();

        // --- 2. Element Selectors ---
        const produceItems = document.querySelectorAll('.produce-item');
        const modal = document.getElementById('product-detail');
        const closeBtn = document.getElementById('close-detail');
        const nameEl = document.getElementById('detail-name');
        const priceEl = document.getElementById('detail-price');
        const descEl = document.getElementById('detail-description');
        const qtyEl = document.getElementById('qty-number');
        const addToCartBtn = document.querySelector('.add-cart-btn');
        const stockText = document.getElementById("detail-stock");

        let currentProductId = null;
        let currentQty = 1;

        // --- 3. View Details (Event Delegation) ---
        document.addEventListener('click', function (event) {
            if (event.target.classList.contains('view-detail-btn')) {
                const btn = event.target;
                const item = btn.closest('.produce-item');
                
                // Get Data from the HTML
                const id = btn.dataset.id;
                const name = item.querySelector('h5').textContent;
                const price = item.querySelector('.text-success').textContent;
                
                // Get stock from the hidden p tag (Ensure this tag exists in your HTML)
                const stockTag = document.getElementById('stock-val-' + id);
                const stockValue = stockTag ? parseInt(stockTag.textContent) : 0;

                // Update Modal Elements
                currentProductId = id;
                nameEl.textContent = name;
                priceEl.textContent = price;
                
                // Placeholder description (You can expand this later)
                descEl.innerHTML = "<li>Freshly harvested.</li><li>High-quality organic produce.</li>"; 

                currentQty = 1;
                qtyEl.textContent = currentQty;

                // Update UI based on Stock
                if (stockValue > 0) {
                    stockText.textContent = "Available stock: " + stockValue;
                    stockText.className = "text-muted";
                    addToCartBtn.textContent = "Add To Cart";
                    addToCartBtn.disabled = false;
                } else {
                    stockText.textContent = "Out of Stock";
                    stockText.className = "text-danger";
                    addToCartBtn.disabled = true;
                    addToCartBtn.textContent = "Sold Out";
                }

                modal.classList.add("active");
            }
        });

        // Close Modal
        closeBtn.addEventListener('click', () => modal.classList.remove('active'));
        window.addEventListener('click', (e) => { if (e.target === modal) modal.classList.remove('active'); });

        // --- 4. Quantity Logic ---
        document.getElementById("qty-minus").addEventListener("click", () => {
            if (currentQty > 1) { 
                currentQty--; 
                qtyEl.textContent = currentQty; 
            }
        });

        document.getElementById("qty-plus").addEventListener("click", () => {
            if (!currentProductId) return;
            // Get current max stock from the hidden tag
            const stockTag = document.getElementById('stock-val-' + currentProductId);
            const maxStock = stockTag ? parseInt(stockTag.textContent) : 0;

            if (currentQty < maxStock) {
                currentQty++; 
                qtyEl.textContent = currentQty;
            }
        });

        // --- 5. Add to Cart Logic ---
        addToCartBtn.addEventListener('click', () => {
            if (!currentProductId) return;
            
            const stockTag = document.getElementById('stock-val-' + currentProductId);
            const maxStock = stockTag ? parseInt(stockTag.textContent) : 0;

            let cart = JSON.parse(localStorage.getItem("farmCart")) || [];
            let existingItemIndex = cart.findIndex(item => item.id === currentProductId);

            if (existingItemIndex !== -1) {
                let newTotalQty = cart[existingItemIndex].qty + currentQty;
                if (newTotalQty > maxStock) {
                    alert(`Sorry, you already have ${cart[existingItemIndex].qty} in your cart. Only ${maxStock} available.`);
                    return;
                }
                cart[existingItemIndex].qty = newTotalQty;
            } else {
                cart.push({ 
                    id: currentProductId, 
                    name: nameEl.textContent, 
                    price: priceEl.textContent, 
                    qty: currentQty 
                });
            }

            localStorage.setItem("farmCart", JSON.stringify(cart));
            addToCartBtn.textContent = "Added!";
            setTimeout(() => { window.location.href = "/orders"; }, 400);
        });

        // --- 6. Scroll, Search, and Filter ---
        // --- 6. Scroll, Search, and Filter ---
const scrollTopBtn = document.getElementById("scrollTopBtn");
window.onscroll = () => { scrollTopBtn.style.display = (window.scrollY > 200) ? "block" : "none"; };
scrollTopBtn.addEventListener("click", () => window.scrollTo({ top: 0, behavior: "smooth" }));

// Search Bar Logic
const searchInput = document.getElementById("search");
if (searchInput) {
    searchInput.addEventListener("keyup", function () {
        const text = this.value.toLowerCase();
        
        // Filter Cards
        document.querySelectorAll('.produce-item').forEach(item => {
            const name = item.querySelector("h5").innerText.toLowerCase();
            item.style.display = name.includes(text) ? "" : "none";
        });

        // Filter Table Rows (Admin View)
        document.querySelectorAll("tbody tr").forEach(row => {
            const name = row.cells[2] ? row.cells[2].innerText.toLowerCase() : "";
            row.style.display = name.includes(text) ? "" : "none";
        });
    });
}

// Category Sidebar Logic
document.querySelectorAll(".product-category-list a").forEach(link => {
    link.addEventListener("click", e => {
        e.preventDefault();
        const cat = link.dataset.category.toLowerCase();

        // Filter Cards
        document.querySelectorAll(".produce-item").forEach(item => {
            const itemCat = item.getAttribute('data-category') || "";
            item.style.display = (cat === "all" || itemCat === cat) ? "" : "none";
        });

        // Filter Table Rows
        document.querySelectorAll("tbody tr").forEach(row => {
            // Adjust the [3] to match whichever column your category is in!
            const rowCat = row.cells[3] ? row.cells[3].innerText.toLowerCase() : "";
            row.style.display = (cat === "all" || rowCat.includes(cat)) ? "" : "none";
        });
    });
});
});
</script>
</body>

</html>